<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<link href="style.css" media="all" rel="stylesheet" type="text/css">
<title>SPC.js</title>
</head>
<body>
<div class="spc-player">
  <img src="http://snes.in/screenshots/seiken-densetsu-2/seiken-densetsu-2.4.png" alt="artwork" width="256" height="224">
  <div class="content">
    <div class="track" id="title">N/A</div>
    <div class="artist" id="game">N/A</div>
    <div class="album" id="year">N/A</div>
    <ul class="controls">
      <li onclick="loadRemote('spc/sd2-10.spc');">❤</li>
      <li onclick="loadRemote('spc/smti-02.spc');">☃</li>
      <li onclick="loadRemote('spc/sfmt-09.spc');">♲</li>
    </ul>
    <progress value="0" max="100" id="progress">
      <div class="tracker active"></div>
    </progress>
    <span id="elapsedtime">00:00</span>
    <span id="duration" style="float:right;">00:00</span>
    <ul class="play-controls">
      <li id="play">▶</li>
    </ul>
  </div>
</div>

<a href="http://codepen.io/markmurray/pen/heAqg">Audio Player design based on the codepen by Mark Murray.</a>

<script src="spc-aurora.js"></script>
<script src="spc.js"></script>
<script>
var example_player;

// document.querySelector('.volume').addEventListener('input', function(event) {
//   if(example_player){
//     example_player.volume = event.target.value;
//   }
// }, false);

var playing = false;
var play = document.getElementById('play');

play.addEventListener("click", function(){
  if (playing) {
    pauseAudio();
  }
  else {
    playAudio();
  }
});

function playAudio(file) {
  if (typeof file === "undefined") {
    if (example_player) {
      example_player.play();
    }
  }
  else {
    loadRemote(file);
  }
  playing = true;
}

function pauseAudio() {
  if (example_player) {
    example_player.pause();
    playing = false;
  }
}

function displayTime(input){
    var mins, sec, msec;
    msec = Math.floor(input);
    secs = msec / 1000;
    mins = Math.floor(secs / 60).toString();
    secs = Math.floor(secs % 60).toString();
    if (secs.length < 2) {
      secs = "0" + secs;
    }
    if (mins.length < 2) {
      mins = "0" + mins;
    }
    return mins + ":" + secs;
}

var current_duration = 0;
function loadRemote(url) {
  if (example_player) {
    pauseAudio()
    document.getElementById('progress').value = 0;
    document.getElementById('elapsedtime').innerText = '00:00';
  }
  example_player = AV.Player.fromURL(url);
  example_player.preload();
  example_player.on('buffer', function(percent){
    console.log('Buffer:', percent);
  });
  example_player.on('progress', function(percent) {
    document.getElementById('progress').value = Math.floor((percent / current_duration) * 100);
    document.getElementById('elapsedtime').innerText = displayTime(percent);
  });
  example_player.on('duration', function(duration){
    console.log('Duration:', duration);
    current_duration = duration;
    document.getElementById('duration').innerText = displayTime(duration);
  });
  example_player.on('metadata', function(metadata) {
    console.log('Metadata:',metadata);
    document.getElementById('title').innerText = metadata['songTitle'];
    document.getElementById('game').innerText = metadata['gameTitle'];
    if (metadata['copyrightYear']) {
      document.getElementById('year').innerText = metadata['copyrightYear'];
    }
    else {
      document.getElementById('year').innerText = '';
    }
  });
  example_player.on('error', function(error) {
    console.log(error);
    throw error;
  });
}

loadRemote('spc/sd2-01.spc');
</script>
</body>
</html>
